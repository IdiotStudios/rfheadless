/* Minimal DOMPurify-like sanitizer for docs usage. This is **not** a full sanitizer. For production, use DOMPurify upstream. */
(function(global){
  function sanitize(dirty){
    // Allow a safe whitelist: a, p, ul, ol, li, code, pre, h1-3, em, strong, blockquote, table, thead, tbody, tr, th, td
    // Remove script/style tags and on* attributes
    const doc = new DOMParser().parseFromString(dirty,'text/html');
    const forbidden = ['script','style','iframe','object','embed'];
    forbidden.forEach(t=>{doc.querySelectorAll(t).forEach(n=>n.remove());});
    // remove attributes starting with on
    doc.querySelectorAll('*').forEach(el=>{for(const attr of Array.from(el.attributes)){if(/^on/i.test(attr.name)){el.removeAttribute(attr.name);} if(attr.name==='href' || attr.name==='src'){ // optionally sanitize javascript: URIs
          if(/^javascript:/i.test(attr.value)){el.removeAttribute(attr.name);} }
    }});
    return doc.body.innerHTML;
  }
  global.DOMPurify={sanitize};
})(this);
